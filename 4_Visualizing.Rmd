---
title: 'Visualizing: `ggplot2`'
author: "AW"
date: '2022-07-01'
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## The package `ggplot2`

We are going to be using the package `ggplot2`, which is actually bundled into a huge package called `tidyverse`. We will install `tidyverse` now, and use a few functions from the packages within. Also, check out tidyverse.org/.


```{r tidyverse, eval=FALSE}
## from CRAN:
install.packages("tidyverse") ## do this once only to install the package on your computer.
```
<br />
```{r tidyverseR, message=FALSE, warning=FALSE}
library(tidyverse) ## do this every time you restart R and need it 
```


## Load Data

The following R code chunk import the data needed. It has the only option `message=FALSE` so that this R code chunk will be evaluate but the output and message will be suppressed.

```{r, message=FALSE}
#National Parks in California
ca <- read_csv("https://raw.githubusercontent.com/OHI-Science/data-science-training/master/data/ca.csv") 

#Acadia National Park
acadia <- read_csv("https://raw.githubusercontent.com/OHI-Science/data-science-training/master/data/acadia.csv")

#Southeast US National Parks
se <- read_csv("https://raw.githubusercontent.com/OHI-Science/data-science-training/master/data/se.csv")

#2016 Visitation for all Pacific West National Parks
visit_16 <- read_csv("https://raw.githubusercontent.com/OHI-Science/data-science-training/master/data/visit_16.csv")

#All Nationally designated sites in Massachusetts
mass <- read_csv("https://raw.githubusercontent.com/OHI-Science/data-science-training/master/data/mass.csv")
```


## Plotting with `ggplot2`

`ggplot2` is a plotting package that makes it simple to create complex plots from data in a data frame.  
<br />
`ggplot` likes data in the ‘long’ format: i.e., a column for every dimension, and a row for every observation. Well structured data will save you lots of time when making figures with `ggplot`.  
<br />
`ggplot` graphics are built step by step by adding new elements. Adding layers in this fashion allows for extensive flexibility and customization of plots.


#### National Park visitation dataset `ca` example

This dataframe is already in a long format where all rows are an observation and all columns are variables. Among the variables in `ca` are:

1. `region`, US region where park is located.
2. `visitors`, the annual visitation for each `year`
3. `park_name`, the name of the national park

To build a ggplot, we need to:

* use the `ggplot()` function and bind the plot to a specific data frame using the data argument
* add `geoms` – graphical representation of the data in the plot (points, lines, bars). `ggplot2` offers many different `geoms`; we will use some common ones today, including: * `geom_point()` for scatter plots, dot plots, etc. * `geom_bar()` for bar charts * `geom_line()` for trend lines, time-series, etc.

To add a `geom` to the plot use `+` operator. Because we have two continuous variables,
let’s use `geom_point()` first and then assign x and y aesthetics (`aes`):

```{r}
ggplot(data = ca) + 
  geom_point(aes(x = year, y = visitors))
```

This isn’t necessarily a useful way to look at the data. We can distinguish each park by added the color argument to the `aes`:

```{r}
ggplot(data = ca) +
    geom_point(aes(x = year, y = visitors, color = park_name))
```

##### Customizing plots

Now, let’s capitalize the x and y axis labels and add a main title to the figure. I also like to remove that standard gray background using a different `theme`. Many themes come built into the `ggplot2` package. My preference is `theme_bw()` but once you start typing `theme_` a list of options will pop up. The last thing I’m going to do is remove the legend title.

```{r}
ggplot(data = ca) +
    geom_point(aes(x = year, y = visitors, color = park_name)) +
    labs(x = "Year",
       y = "Visitation",
       title = "California National Park Visitation") +
    theme_bw() +
    theme(legend.title=element_blank())
```

#### Faceting

`ggplot` has a special technique called **faceting** that allows the user to split one plot into multiple plots based on data in the dataset. We will use it to make a plot of park visitation by state:

```{r}
ggplot(data = se) +
    geom_point(aes(x = year, y = visitors)) +
    facet_wrap(~ state)
```

We can now make the faceted plot by splitting further by park using park_name (within a single plot):

```{r}
 ggplot(data = se) +
     geom_point(aes(x = year, y = visitors, color = park_name)) +
     facet_wrap(~ state, scales = "free") +
     theme_bw() +
     theme(legend.title=element_blank())
```

#### Geometric objects (geoms)

A **geom** is the geometrical object that a plot uses to represent data. People often describe plots by the type of geom that the plot uses. For example, bar charts use bar geoms, line charts use line geoms, boxplots use boxplot geoms, and so on. Scatterplots break the trend; they use the point geom. You can use different geoms to plot the same data. To change the geom in your plot, change the geom function that you add to `ggplot()`. Let’s look at a few ways of viewing the distribution of annual visitation (`visitors`) for each park (`park_name`).

```{r}
ggplot(data = se) + 
  geom_jitter(aes(x = park_name, y = visitors, color = park_name), 
              width = 0.1, 
              alpha = 0.4) +
  coord_flip() +
  theme(legend.position = "none") 
```


```{r}
ggplot(se, aes(x = park_name, y = visitors)) + 
  geom_boxplot() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) # format the label on x-axis
```

None of these are great for visualizing data over time. We can use `geom_line()` in the same way we used `geom_point`.

```{r}
ggplot(se, aes(x = year, y = visitors, color = park_name)) +
   geom_line()
```


